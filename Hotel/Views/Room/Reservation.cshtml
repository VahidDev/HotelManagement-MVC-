@model RoomReservationViewModel
@{
    int count = 0;
}
<!-- banner -->
<section class="hotel-banner-simple hotel-transition-bottom">

    <div class="container">
        <div class="row">
            <div class="col-lg-12">

                <div class="hotel-center hotel-title-frame">
                    <h1 class="hotel-mb-20 hotel-h1-inner">Suite Otaq</h1>
                    <ul class="hotel-breadcrumbs">
                        <li><a asp-controller="Home" asp-action="Index">Ana Səhifə</a></li>
                        <li><a href="rooms.html">Otaqlar</a></li>
                        <li><span>@Model.Room.Name</span></li>
                    </ul>
                </div>

            </div>
        </div>
    </div>
</section>
<!-- banner end -->
<!-- room -->
<div class="hotel-p-100-100">
    <div class="container">
        <div class="row" data-sticky-container>
            <div class="col-lg-8">

                <div class="hotel-room-detail-slider-frame hotel-mb-60">
                    <div class="swiper-container hotel-rd-slider-2 hotel-mb-10">
                        <div class="swiper-wrapper">

                            <div class="swiper-slide">
                                <a data-fancybox="gallery" href="img/rooms/2.jpg" class="hotel-room-detail-photo-lg" data-swiper-parallax="-80" data-swiper-parallax-scale="1.2" data-swiper-parallax-duration="400">
                                    <img src="~/img/rooms/@Model.MainImage.Name" alt="room">
                                    <span class="hotel-zoom"><i class="fas fa-search-plus"></i></span>
                                </a>
                            </div>
                            @foreach (RoomImage image in Model.Images)
                            {
                                <div class="swiper-slide">
                                    <a data-fancybox="gallery" class="hotel-room-detail-photo-lg" data-swiper-parallax="-80" data-swiper-parallax-scale="1.2" data-swiper-parallax-duration="400">
                                        <img src="~/img/rooms/@image.Name" alt="room">
                                        <span class="hotel-zoom"><i class="fas fa-search-plus"></i></span>
                                    </a>
                                </div>
                            }


                        </div>
                    </div>
                    <div class="swiper-container hotel-rd-slider-1">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide">
                                <div class="hotel-room-detail-photo-sm">
                                    <img src="~/img/rooms/@Model.MainImage.Name" alt="room">
                                </div>
                            </div>
                            @foreach (RoomImage image in Model.Images)
                            {
                                <div class="swiper-slide">
                                    <div class="hotel-room-detail-photo-sm">
                                        <img src="~/img/rooms/@image.Name" alt="room">
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>

                <!-- description -->
                <section class="hotel-mb-60 hotel-scroll-animation">
                    <h3 class="hotel-mb-40">@Model.Room.Name</h3>
                    <p>
                        @Model.Room.Description
                    </p>
                </section>
                <!-- description end -->
                <!-- features -->
                <section class="hotel-mb-60">
                    <div class="row">
                        <div class="col-lg-12">
                            <h3 class="hotel-mb-40 hotel-scroll-animation">Otağa daxildir</h3>
                        </div>
                        @foreach (Facility facility in Model.Facilities)
                        {
                            <div class="col-6 col-md-3">
                                <!-- icon box -->
                                <div class="hotel-icon-box hotel-icon-box-sm hotel-scroll-animation">
                                    <img src="~/img/features/@facility.Image" alt="icon" class="hotel-mb-10">
                                    <h5>@facility.Name</h5>
                                </div>
                                <!-- icon box end -->
                            </div>
                        }
                    </div>
                </section>
                <!-- features end -->
                <!-- services -->
                <section class="hotel-mb-30">
                    <div class="row">
                        <div class="col-lg-12">
                            <h3 class="hotel-mb-40 hotel-scroll-animation">Otağa Daxildir</h3>
                        </div>
                        <div class="col-lg-4">

                            <!-- service card -->
                            <div class="hotel-ath-card hotel-scroll-animation">
                                <div class="hotel-cover-frame">
                                    <img src="~/img/services/4.jpg" alt="cover">
                                </div>
                                <div class="hotel-card-description">
                                    <h5>Oyun Otağı</h5>
                                </div>
                            </div>
                            <!-- service card end -->

                        </div>
                        <div class="col-lg-4">

                            <!-- service card -->
                            <div class="hotel-ath-card hotel-scroll-animation">
                                <div class="hotel-cover-frame">
                                    <img src="~/img/services/2.jpg" alt="cover">
                                </div>
                                <div class="hotel-card-description">
                                    <h5>Hovuz</h5>
                                </div>
                            </div>
                            <!-- service card end -->

                        </div>
                        <div class="col-lg-4">

                            <!-- service card -->
                            <div class="hotel-ath-card hotel-scroll-animation">
                                <div class="hotel-cover-frame">
                                    <img src="~/img/services/3.jpg" alt="cover">
                                </div>
                                <div class="hotel-card-description">
                                    <h5>Restorant</h5>
                                </div>
                            </div>
                            <!-- service card end -->

                        </div>
                    </div>
                </section>
                <!-- services end -->
                <!-- reviews -->
                <section class="hotel-mb-30 comments">
                    <div class="row mycomments">
                        <div class="col-lg-12">
                            <h3 class="hotel-mb-40 hotel-scroll-animation">Rəylər</h3>
                        </div>
                        @foreach (Comment comment in Model.Comments)
                        {
                            <div class="col-lg-12">

                                <div class="hotel-review-card hotel-scroll-animation">
                                    <div class="hotel-card-header">
                                        <div class="hotel-name-and-photo">
                                            <div class="hotel-avatar-frame">
                                                <img src="~/img/faces/3.jpg" alt="Avatar">
                                            </div>
                                            <div>
                                                <h5>@comment.FullName</h5>
                                                <span>@comment.StartDate.ToString("dd.MM.yyyy")</span>
                                            </div>
                                        </div>
                                        <ul class="hotel-stars">
                                            @{
                                                float rating = comment.Rating.Name;
                                                bool isInteger = Int32.TryParse(rating.ToString(), out int result);
                                                int intRating = (int)rating;
                                            }
                                            @for (int i = 0; i < intRating; i++)
                                            {
                                                count++;
                                                <li><i class="fas fa-star"></i></li>
                                            }
                                            @if (!isInteger)
                                            {
                                                <li><i class="fas fa-star-half-alt"></i></li>
                                                count++;
                                            }
                                            @while (count != 5)
                                            {
                                                count++;
                                                <li><i class="far fa-star"></i></li>
                                            }
                                            @{
                                                count = 0;
                                            }
                                        </ul>
                                    </div>
                                    <blockquote>
                                        @comment.Content
                                    </blockquote>

                                </div>

                            </div>
                        }
                    </div>
                </section>
                <!-- reviews end -->

                <section>
                    <div class="row">
                        <div class="col-lg-12">
                            <h3 class="hotel-mb-40 hotel-scroll-animation">Rəy Bildirin</h3>
                        </div>
                        <div class="col-lg-12">
                            <form class="hotel-scroll-animation">
                                <div class="row no-nice-select">
                                    <div class="col-lg-6">
                                        <input type="text" id="name" placeholder="Adınız">
                                    </div>
                                    <div class="col-lg-6">
                                        <input type="email" id="email" placeholder="Email">
                                    </div>
                                    <div class="col-lg-12">
                                        <textarea name="content" id="content" rows="8" placeholder="Şərh"></textarea>
                                    </div>
                                    <div class="col-lg-12">
                                        <span class="text-danger" id="validation"></span>
                                    </div>
                                    <div class="col-lg-12 mb-3">
                                        <select id="mySelect" style="overflow-y:scroll;" asp-items="new SelectList(Model.Ratings,nameof(Rating.Id),nameof(Rating.Name))">
                                            <option disabled selected>Rate it!</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-12">
                                        <div class="hotel-form-submit-frame">
                                            <!-- temporary button to show the popup -->
                                            <a class="hotel-btn" id="SendComment">Göndər</a>
                                            <!-- <button class="hotel-btn">Send</button> -->
                                            <div class="hotel-text-sm">*Şəxsi məlumatlarınızı üçüncü tərəflərə açıqlamayacağımıza söz veririk..</div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

            </div>
            <div class="col-lg-4">
                <!-- sidebar -->
                <div class="hotel-sticky hotel-stycky-right" data-margin-top="100">

                    <!-- room info -->
                    <div class="hotel-room-features-lg hotel-mb-20">
                        <div class="hotel-feature">
                            <div class="hotel-icon-frame"><img src="~/img/icons/bed.svg" alt="icon"></div>
                            <span>@Model.Room.Type Nəfərlik</span>
                        </div>
                        <div class="hotel-feature">
                            <div class="hotel-icon-frame"><img src="~/img/icons/square.svg" alt="icon"></div>
                            <span>@Model.Room.Size Ft²</span>
                        </div>
                    </div>
                    <!-- room info end -->

                    <div class="hotel-price-card hotel-mb-20">
                        <div class="hotel-price-number">@Model.Room.Price M</div>
                        <div class="hotel-btn">Rezervasiya</div>
                    </div>

                    <div class="hotel-book-form">
                        <form method="post" asp-action="Reservation"> 
                             <input type="hidden" id="roomId" value="@Model.Room.Id" asp-for="RoomId"/>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="hotel-input-frame">
                                        <label asp-for="StartDate">Giriş</label>
                                        <input asp-for="StartDate" type="text" class="datepicker-here" data-position="bottom left" placeholder="Tarix Seçin" autocomplete="off" readonly="readonly">
                                        <span asp-validation-for="StartDate" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-lg-12">
                                    <div class="hotel-input-frame">
                                        <label asp-for="EndDate" class="hotel-add-icon">Çıxış</label>
                                        <input asp-for="EndDate" type="text" class="datepicker-here" data-position="bottom left" placeholder="Tarix Seçin" autocomplete="off" readonly="readonly">
                                        <span asp-validation-for="EndDate" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="hotel-select-frame">
                                        <label asp-for="AdultCount">Böyük</label>
                                        <select asp-for="AdultCount">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                        </select>
                                    </div>
                                    <span asp-validation-for="AdultCount" class="text-danger"></span>
                                </div>
                                <div class="col-6">
                                    <div class="hotel-select-frame">
                                        <label asp-for="ChildCount">Uşaq</label>
                                        <select asp-for="ChildCount">
                                            <option value="0">0</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                        </select>
                                    </div>
                                    <span asp-validation-for="ChildCount" class="text-danger"></span>
                                </div>
                                <div class="col-lg-12 hotel-center">
                                    <button type="submit" class="hotel-btn"><img src="~/img/icons/search.svg" class="hotel-zoom" alt="icon">Rezerv et</button>
                                </div>
                            </div>
                        </form>
                    </div>

                </div>
                <!-- sidebar end -->

            </div>
        </div>
    </div>
</div>
<!-- room end -->
<!--Extra info for the footer about the hotel-->
@section Footer{
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="footer-logo">
                    <a href="~/#"><img src="~/img/logo" alt=""></a>
                </div>
            </div>
        </div>
        <div class="row pb-50">
            <div class="col-lg-3 col-sm-6">
                <div class="single-footer-widget">
                    <h5>Location</h5>
                    <div class="widget-text">
                        <i class="fa fa-map-marker"></i>
                        <p>@Model.Room.Hotel.Address, <br />@Model.Room.Hotel.City</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-sm-6">
                <div class="single-footer-widget">
                    <h5>Reception</h5>
                    <div class="widget-text">
                        <i class="fa fa-phone"></i>
                        <p>@Model.Room.Hotel.ReceptionPhone</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-sm-6">
                <div class="single-footer-widget">
                    <h5>Shuttle Service</h5>
                    <div class="widget-text">
                        <i class="fa fa-phone"></i>
                        <p>@Model.Room.Hotel.ShuttleServicePhone</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-sm-6">
                <div class="single-footer-widget">
                    <h5>Restaurant</h5>
                    <div class="widget-text">
                        <i class="fa fa-phone"></i>
                        <p>@Model.Room.Hotel.RestaurantPhone</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<!--Add Current item class to the top bar for the Room Section-->
@section Scripts{
    <partial name="_ValidationPartial" />
    <script asp-append-version="true">
        "use strict";
        window.onload = () => {
            $(".hotel-right-side .hotel-menu ul .current-item").removeClass("current-item");
            $(".hotel-right-side .hotel-menu ul li:nth-child(4)").addClass("current-item");
            document.querySelector("#SendComment").addEventListener("click", () => {
                if (check()) {
                    sendComment();
                }
            });
        };
        function sendComment() {
            let xhr = new XMLHttpRequest();
            xhr.open("POST",
                "https://localhost:44340/Room/Comment?name=" + $("#name").val() + "&content="
                + $("#content").val() + "&email=" + $("#email").val() +
                "&roomId=" + $("#roomId").val() + "&ratingId=" + $("#mySelect").val()
            );
            xhr.send();
            xhr.onload = () => {
                if (xhr.status == 200 && xhr.response != null) {
                    let res = JSON.parse(xhr.response);
                    let day = res["startDate"].substring(8, 10);
                    let year = res["startDate"].substring(0, 4);
                    let month = res["startDate"].substring(5, 7);
                    let date= `${day}.${month}.${year}`;
                    let el1 = `<div class="col-lg-12">
                                <div class="hotel-review-card hotel-scroll-animation">
                                    <div class="hotel-card-header">
                                        <div class="hotel-name-and-photo">
                                            <div class="hotel-avatar-frame">
                                                <img src="/img/faces/3.jpg" alt="Avatar">
                                            </div>
                                            <div>
                                                <h5>${res["fullName"]}</h5>
                                                <span>${date}</span>
                                            </div>
                                        </div>
                                        <ul class="hotel-stars">`;
                    let count = 0;
                    let isInteger = Number.isInteger(res["rating"]["name"]);
                    let starCount = Math.floor(res["rating"]["name"]);
                    for (let i = 0; i < starCount; i++)
                                            {
                                                count++;
                                        el1 += `<li><i class="fas fa-star"></i></li>`;
                    }
                    if (!isInteger) {
                        el1 += `<li><i class="fas fa-star-half-alt"></i></li>`;
                        count++;
                    }
                                            while (count != 5)
                                            {
                                                count++;
                                                el1 += `<li><i class="far fa-star"></i></li>`;
                                            }

                    count = 0;
                    let el2 = el1+`</ul></div><blockquote> ${res["content"]}</blockquote></div></div>`
                    $(".comments .mycomments").append(el2);
                    $("#name").val("");
                    $("#email").val("");
                    $("#content").val("");
                }
            }
        }
        function check() {
            $("#validation").text("");
            if ($("#name").val() === '' || $("#email").val() === ''
                || $("#content").val() === '') {
                $("#validation").text("You must fill all the gaps")
                return false;
            }
            let value = $("#email")[0].value
            let regex = /^([\w-\.]+)@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
            if (!regex.test(value)) {
                $("#validation").text("Invalid Email!");
                return false;
            }
            return true;
        }
    </script>
<style>
    .no-nice-select .nice-select {
        display: none !important;
    }
    #mySelect{
        display:block !important;
    }
</style>
}